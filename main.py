# 导入日志监控库logfire
import logfire
import asyncio

# 导入主控制器
from agents.main_agent import start_video_generation

# 配置logfire日志监控
logfire.configure()
# 对pydantic_ai进行监控
logfire.instrument_pydantic_ai()


async def main():
    """
    主函数 - AI视频生成系统入口
    """
    print("🎬 欢迎使用AI视频生成系统!")
    print("=" * 50)

    # 示例大纲 - 用户可以修改这个大纲
    sample_outline = """
《九转乾坤》

世界观设定：

以"玄天大陆"为背景，武道为尊，强者可移山填海。大陆由三大皇朝、七大宗门掌控，妖兽占据蛮荒之地。
修炼体系：淬体境→凝元境→真灵境→化海境→通天境→尊者境→圣者境（每境分九重）
特殊设定：上古时期遗留"九转神塔"，传说获得九转传承者可掌乾坤
核心脉络：

男主从现代穿越，身负废物体质却暗藏神脉，通过伪装与智谋逆天改命，与女主从互相利用到生死相守，最终揭开穿越之谜。

人物设定：

▶ 萧陌（男主）

表面：萧家分支的废物少爷，天生经脉淤塞
真相：穿越者（前世为考古学家），体内封印九转神脉
特殊能力：可看破功法破绽的"洞玄之眼"
武器：伪装成烧火棍的太古神兵"乾坤棍"
▶ 叶清璃（女主）

表面：叶家大小姐，冰系天才，性格清冷
真相：体内封印着上古冰凰神魂
隐藏身份：三大皇朝之一的长公主转世
武器：寒玉剑（实为封印钥匙）
▶ 重要配角：

老乞丐（男主师父）：伪装成乞丐的九转神塔守护者
萧炎（男二）：萧家天才，前期打压男主后期成为挚友
林琅天（大反派）：七大宗门少主，天生重瞳的绝世天才
分卷大纲：

第一卷《废材觉醒》

▶ 第1章：考古学家萧陌意外触发九转神塔穿越，成为被欺凌的萧家分支少爷

▶ 第3章：假装屈服实则暗中修炼，在家族大比中用现代格斗术击败对手

▶ 第5章：为获取资源伪装成蒙面人参加黑市比武，与叶清璃初次相遇

第二卷《九转神脉》

▶ 第8章：秘境试炼中故意示弱，引得各方天才争夺宝物时坐收渔利

▶ 第10章：假装误食毒果获得"临时力量"，实则激活第一道神脉

▶ 第12章：与叶清璃被困古墓，被迫合作时发现彼此秘密却假装不知

第三卷《双面天骄》

▶ 15章：以废物身份参加七宗会武，暗中用洞玄之眼破解各派绝学

▶ 18章：叶清璃寒毒发作，男主假装偶然获得解药（实为自身精血）

▶ 20章：林琅天识破男主伪装，设局逼其现出真身

第四卷《乾坤颠覆》

▶ 23章：男主主动暴露"部分实力"误导敌人，实则已觉醒五道神脉

▶ 26章：叶清璃身份暴露遭追杀，男主布下连环局反杀追兵

▶ 30章：最终决战时假装不敌，引林琅天进入神塔陷阱完成反杀

关键爽点设计：

1. 武斗场连败十名高手后假装力竭，诱使赌局翻盘

2. 拍卖会故意抬价让仇家高价拍得假功法

3. 用现代化学知识炼制"独门毒药"震慑丹道大师

4. 危急时刻突然展现超越当前境界的实力

感情线发展：

从互相利用到生死相依
男主始终假装不知女主身份秘密
关键转折：女主为救男主强行解封冰凰神魂
    """

    # 用户配置区域
    print("📝 当前使用的故事大纲:")
    print("-" * 30)
    print(sample_outline)
    print("-" * 30)

    # 配置生成参数
    start_chapter = 1  # 开始章节
    end_chapter = 1  # 结束章节（可以设置为3来生成所有章节）
    scene_count = 15  # 每章节场景数量（范围：5-50）

    print("🎯 生成设置:")
    print(f"   开始章节: 第{start_chapter}章")
    print(f"   结束章节: 第{end_chapter}章")
    print(f"   每章场景数: {scene_count}个")
    print("=" * 50)

    # 启动AI视频生成
    result = await start_video_generation(
        outline=sample_outline,
        start_chapter=start_chapter,
        end_chapter=end_chapter,
        scene_count=scene_count,
        requirement="情节跌宕起伏，要体现出复仇的爽感。",
    )

    print("\n" + "=" * 50)
    print("📋 生成结果:")
    print(result)
    print("=" * 50)


if __name__ == "__main__":
    asyncio.run(main())
